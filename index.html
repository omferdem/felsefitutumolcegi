<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Akademik Asistan V44</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Sacramento&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* Klasik V21/V33 TemasÄ± */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; 
            -webkit-tap-highlight-color: transparent; 
            user-select: none;
            overflow-x: hidden;
        }
        
        .glass { 
            background: rgba(30, 41, 59, 0.7); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
        }

        .input-dark { 
            background: #1e293b; 
            border: 1px solid #334155; 
            color: white; 
            transition: all 0.3s; 
        }
        .input-dark:focus { border-color: #3b82f6; outline: none; }

        .signature { font-family: 'Sacramento', cursive; letter-spacing: -1px; }
        
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); } 100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); } }
        .urgent-pulse { animation: pulse-red 2s infinite; }
        
        /* Ekran GÃ¶rÃ¼ntÃ¼sÃ¼ Modu */
        .screenshot-mode { background-color: #ffffff !important; color: #000000 !important; }
        .screenshot-mode .app-container { background-color: #ffffff !important; box-shadow: none !important; }
        .screenshot-mode .no-screenshot { display: none !important; }
        .screenshot-mode .glass { 
            background: white !important; 
            border: 1px solid #000 !important; 
            color: black !important; 
            box-shadow: none !important; 
            backdrop-filter: none !important;
        }
        .screenshot-mode th { background-color: #f3f4f6 !important; color: black !important; border: 1px solid #000 !important; }
        .screenshot-mode td { border: 1px solid #000 !important; color: black !important; }
        .screenshot-mode input { color: black !important; background: transparent !important; border: none !important; text-align: center; }

        /* Ders Renkleri - CanlÄ± */
        .lesson-lisans { background: linear-gradient(135deg, #0d9488 0%, #115e59 100%) !important; border-left: 3px solid #5eead4 !important; color: white !important; } 
        .lesson-yuksek { background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%) !important; border-left: 3px solid #a5b4fc !important; color: white !important; } 
        .lesson-doktora { background: linear-gradient(135deg, #e11d48 0%, #be123c 100%) !important; border-left: 3px solid #fda4af !important; color: white !important; } 
        .lesson-seminer { background: linear-gradient(135deg, #d97706 0%, #b45309 100%) !important; border-left: 3px solid #fcd34d !important; color: white !important; } 

        /* Buton Renkleri */
        .btn-lisans { background-color: #0d9488; color: white; border: 1px solid #5eead4; }
        .btn-yuksek { background-color: #4f46e5; color: white; border: 1px solid #a5b4fc; }
        .btn-doktora { background-color: #e11d48; color: white; border: 1px solid #fda4af; }
        .btn-seminer { background-color: #d97706; color: white; border: 1px solid #fcd34d; }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
        ::-webkit-calendar-picker-indicator { filter: invert(1); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        const safeGet = (key, def) => { 
            try { 
                const val = localStorage.getItem(key);
                return val ? JSON.parse(val) : def; 
            } catch (e) { return def; } 
        };

        const UNIVERSITIES = [
            { name: "Abant Ä°zzet Baysal Ãœni.", city: "Bolu", url: "https://www.ibu.edu.tr/" },
            { name: "AdÄ±yaman Ãœni.", city: "Adiyaman", url: "https://adiyaman.edu.tr/" },
            { name: "Adnan Menderes Ãœni.", city: "Aydin", url: "https://www.adu.edu.tr/" },
            { name: "Afyon Kocatepe Ãœni.", city: "Afyonkarahisar", url: "https://aku.edu.tr/" },
            { name: "AÄŸrÄ± Ä°brahim Ã‡eÃ§en Ãœni.", city: "Agri", url: "https://www.agri.edu.tr/" },
            { name: "Akdeniz Ãœni.", city: "Antalya", url: "https://www.akdeniz.edu.tr/duyurular" },
            { name: "Aksaray Ãœni.", city: "Aksaray", url: "https://www.aksaray.edu.tr/" },
            { name: "Alanya Alaaddin Keykubat Ãœni.", city: "Antalya", url: "https://www.alanya.edu.tr/" },
            { name: "Amasya Ãœni.", city: "Amasya", url: "https://www.amasya.edu.tr/" },
            { name: "Anadolu Ãœni.", city: "Eskisehir", url: "https://www.anadolu.edu.tr/duyurular" },
            { name: "Ankara HacÄ± Bayram Veli Ãœni.", city: "Ankara", url: "https://hacibayram.edu.tr/" },
            { name: "Ankara Sosyal Bilimler Ãœni.", city: "Ankara", url: "https://www.asbu.edu.tr/" },
            { name: "Ankara Ãœni.", city: "Ankara", url: "https://www.ankara.edu.tr/duyurular" },
            { name: "Ankara YÄ±ldÄ±rÄ±m BeyazÄ±t Ãœni.", city: "Ankara", url: "https://aybu.edu.tr/" },
            { name: "Ardahan Ãœni.", city: "Ardahan", url: "https://www.ardahan.edu.tr/" },
            { name: "Artvin Ã‡oruh Ãœni.", city: "Artvin", url: "https://www.artvin.edu.tr/" },
            { name: "AtatÃ¼rk Ãœni.", city: "Erzurum", url: "https://www.atauni.edu.tr/duyurular" },
            { name: "BalÄ±kesir Ãœni.", city: "Balikesir", url: "https://www.balikesir.edu.tr/" },
            { name: "BandÄ±rma Onyedi EylÃ¼l Ãœni.", city: "Balikesir", url: "https://www.bandirma.edu.tr/" },
            { name: "BartÄ±n Ãœni.", city: "Bartin", url: "https://w3.bartin.edu.tr/" },
            { name: "Batman Ãœni.", city: "Batman", url: "https://batman.edu.tr/" },
            { name: "Bayburt Ãœni.", city: "Bayburt", url: "https://www.bayburt.edu.tr/" },
            { name: "Bilecik Åžeyh Edebali Ãœni.", city: "Bilecik", url: "http://www.bilecik.edu.tr/" },
            { name: "BingÃ¶l Ãœni.", city: "Bingol", url: "http://www.bingol.edu.tr/" },
            { name: "Bitlis Eren Ãœni.", city: "Bitlis", url: "https://www.beu.edu.tr/" },
            { name: "BoÄŸaziÃ§i Ãœni.", city: "Istanbul", url: "https://bogazici.edu.tr/" },
            { name: "Bozok Ãœni.", city: "Yozgat", url: "https://bozok.edu.tr/" },
            { name: "Bursa Teknik Ãœni.", city: "Bursa", url: "https://www.btu.edu.tr/" },
            { name: "BÃ¼lent Ecevit Ãœni.", city: "Zonguldak", url: "https://w3.beun.edu.tr/" },
            { name: "Celal Bayar Ãœni.", city: "Manisa", url: "https://www.mcbu.edu.tr/" },
            { name: "Cumhuriyet Ãœni.", city: "Sivas", url: "https://www.cumhuriyet.edu.tr/" },
            { name: "Ã‡anakkale Onsekiz Mart Ãœni.", city: "Canakkale", url: "https://www.comu.edu.tr/" },
            { name: "Ã‡ankÄ±rÄ± Karatekin Ãœni.", city: "Cankiri", url: "https://karatekin.edu.tr/" },
            { name: "Ã‡ukurova Ãœni.", city: "Adana", url: "https://www.cu.edu.tr/duyurular" },
            { name: "Dicle Ãœni.", city: "Diyarbakir", url: "https://www.dicle.edu.tr/tr/duyurular" },
            { name: "Dokuz EylÃ¼l Ãœni.", city: "Izmir", url: "https://www.deu.edu.tr/duyurular/" },
            { name: "DumlupÄ±nar Ãœni.", city: "Kutahya", url: "https://dpu.edu.tr/" },
            { name: "DÃ¼zce Ãœni.", city: "Duzce", url: "https://duzce.edu.tr/" },
            { name: "Ege Ãœni.", city: "Izmir", url: "https://ege.edu.tr/tr-0/duyurular.html" },
            { name: "Erciyes Ãœni.", city: "Kayseri", url: "https://www.erciyes.edu.tr/tr/duyurular" },
            { name: "Erzincan Binali YÄ±ldÄ±rÄ±m Ãœni.", city: "Erzincan", url: "https://ebyu.edu.tr/" },
            { name: "Erzurum Teknik Ãœni.", city: "Erzurum", url: "https://www.erzurum.edu.tr/" },
            { name: "EskiÅŸehir Osmangazi Ãœni.", city: "Eskisehir", url: "https://ogu.edu.tr/" },
            { name: "FÄ±rat Ãœni.", city: "Elazig", url: "http://www.firat.edu.tr/tr/duyurular" },
            { name: "Galatasaray Ãœni.", city: "Istanbul", url: "https://gsu.edu.tr/" },
            { name: "Gazi Ãœni.", city: "Ankara", url: "https://gazi.edu.tr/duyurular" },
            { name: "Gaziantep Ãœni.", city: "Gaziantep", url: "https://www.gantep.edu.tr/" },
            { name: "Gebze Teknik Ãœni.", city: "Kocaeli", url: "https://www.gtu.edu.tr/" },
            { name: "Giresun Ãœni.", city: "Giresun", url: "https://giresun.edu.tr/" },
            { name: "GÃ¼mÃ¼ÅŸhane Ãœni.", city: "Gumushane", url: "https://www.gumushane.edu.tr/" },
            { name: "Hacettepe Ãœni.", city: "Ankara", url: "https://www.hacettepe.edu.tr/duyurular" },
            { name: "Hakkari Ãœni.", city: "Hakkari", url: "https://www.hakkari.edu.tr/" },
            { name: "Harran Ãœni.", city: "Sanliurfa", url: "https://www.harran.edu.tr/" },
            { name: "Hitit Ãœni.", city: "Corum", url: "https://www.hitit.edu.tr/" },
            { name: "IÄŸdÄ±r Ãœni.", city: "Igdir", url: "https://www.igdir.edu.tr/" },
            { name: "Ä°nÃ¶nÃ¼ Ãœni.", city: "Malatya", url: "https://www.inonu.edu.tr/" },
            { name: "Ä°skenderun Teknik Ãœni.", city: "Hatay", url: "https://iste.edu.tr/" },
            { name: "Ä°stanbul Medeniyet Ãœni.", city: "Istanbul", url: "https://medeniyet.edu.tr/" },
            { name: "Ä°stanbul Teknik Ãœni. (Ä°TÃœ)", city: "Istanbul", url: "https://www.itu.edu.tr/duyurular" },
            { name: "Ä°stanbul Ãœni.", city: "Istanbul", url: "https://www.istanbul.edu.tr/tr/duyurular" },
            { name: "Ä°zmir Katip Ã‡elebi Ãœni.", city: "Izmir", url: "https://ikcu.edu.tr/" },
            { name: "Ä°zmir YÃ¼ksek Teknoloji EnstitÃ¼sÃ¼", city: "Izmir", url: "https://iyte.edu.tr/" },
            { name: "Kafkas Ãœni.", city: "Kars", url: "https://www.kafkas.edu.tr/" },
            { name: "KahramanmaraÅŸ SÃ¼tÃ§Ã¼ Ä°mam Ãœni.", city: "Kahramanmaras", url: "https://ksu.edu.tr/" },
            { name: "KarabÃ¼k Ãœni.", city: "Karabuk", url: "https://karabuk.edu.tr/" },
            { name: "Karadeniz Teknik Ãœni. (KTÃœ)", city: "Trabzon", url: "https://www.ktu.edu.tr/duyurular" },
            { name: "KaramanoÄŸlu Mehmetbey Ãœni.", city: "Karaman", url: "https://www.kmu.edu.tr/" },
            { name: "Kastamonu Ãœni.", city: "Kastamonu", url: "https://kastamonu.edu.tr/" },
            { name: "KÄ±rÄ±kkale Ãœni.", city: "Kirikkale", url: "https://kku.edu.tr/" },
            { name: "KÄ±rklareli Ãœni.", city: "Kirklareli", url: "https://klu.edu.tr/" },
            { name: "Kilis 7 AralÄ±k Ãœni.", city: "Kilis", url: "https://kilis.edu.tr/" },
            { name: "Kocaeli Ãœni.", city: "Kocaeli", url: "https://kocaeli.edu.tr/" },
            { name: "Konya Teknik Ãœni.", city: "Konya", url: "https://www.ktun.edu.tr/tr/Universite/Duyurular" },
            { name: "KTO Karatay Ãœni.", city: "Konya", url: "https://www.karatay.edu.tr/duyurular" },
            { name: "Marmara Ãœni.", city: "Istanbul", url: "https://www.marmara.edu.tr/duyurular" },
            { name: "Mehmet Akif Ersoy Ãœni.", city: "Burdur", url: "https://www.mehmetakif.edu.tr/" },
            { name: "Mersin Ãœni.", city: "Mersin", url: "https://mersin.edu.tr/" },
            { name: "Mimar Sinan GÃ¼zel Sanatlar Ãœni.", city: "Istanbul", url: "https://msgsu.edu.tr/" },
            { name: "MuÄŸla SÄ±tkÄ± KoÃ§man Ãœni.", city: "Mugla", url: "https://mu.edu.tr/" },
            { name: "Mustafa Kemal Ãœni.", city: "Hatay", url: "https://www.mku.edu.tr/" },
            { name: "MuÅŸ Alparslan Ãœni.", city: "Mus", url: "https://alparslan.edu.tr/" },
            { name: "NamÄ±k Kemal Ãœni.", city: "Tekirdag", url: "http://nku.edu.tr/" },
            { name: "Necmettin Erbakan Ãœni.", city: "Konya", url: "https://www.erbakan.edu.tr/duyurular" },
            { name: "NevÅŸehir HacÄ± BektaÅŸ Veli Ãœni.", city: "Nevsehir", url: "https://nevsehir.edu.tr/" },
            { name: "NiÄŸde Ã–mer Halisdemir Ãœni.", city: "Nigde", url: "https://ohu.edu.tr/" },
            { name: "Ondokuz MayÄ±s Ãœni.", city: "Samsun", url: "https://omu.edu.tr/" },
            { name: "Ordu Ãœni.", city: "Ordu", url: "https://odu.edu.tr/" },
            { name: "Orta DoÄŸu Teknik Ãœni. (ODTÃœ)", city: "Ankara", url: "https://www.metu.edu.tr/tr/duyurular" },
            { name: "Osmaniye Korkut Ata Ãœni.", city: "Osmaniye", url: "https://osmaniye.edu.tr/" },
            { name: "Pamukkale Ãœni.", city: "Denizli", url: "https://pau.edu.tr/" },
            { name: "Recep Tayyip ErdoÄŸan Ãœni.", city: "Rize", url: "https://erdogan.edu.tr/" },
            { name: "Sakarya UygulamalÄ± Bilimler Ãœni.", city: "Sakarya", url: "https://subu.edu.tr/" },
            { name: "Sakarya Ãœni.", city: "Sakarya", url: "https://sakarya.edu.tr/" },
            { name: "SelÃ§uk Ãœni.", city: "Konya", url: "https://www.selcuk.edu.tr/Duyurular" },
            { name: "Siirt Ãœni.", city: "Siirt", url: "https://siirt.edu.tr/" },
            { name: "Sinop Ãœni.", city: "Sinop", url: "https://sinop.edu.tr/" },
            { name: "SÃ¼leyman Demirel Ãœni.", city: "Isparta", url: "https://sdu.edu.tr/" },
            { name: "ÅžÄ±rnak Ãœni.", city: "Sirnak", url: "https://sirnak.edu.tr/" },
            { name: "Trakya Ãœni.", city: "Edirne", url: "https://trakya.edu.tr/" },
            { name: "Tunceli Ãœni.", city: "Tunceli", url: "https://munzur.edu.tr/" },
            { name: "UludaÄŸ Ãœni.", city: "Bursa", url: "https://uludag.edu.tr/" },
            { name: "UÅŸak Ãœni.", city: "Usak", url: "https://usak.edu.tr/" },
            { name: "Yalova Ãœni.", city: "Yalova", url: "https://yalova.edu.tr/" },
            { name: "YÄ±ldÄ±z Teknik Ãœni.", city: "Istanbul", url: "https://yildiz.edu.tr/" },
            { name: "YÃ¼zÃ¼ncÃ¼ YÄ±l Ãœni.", city: "Van", url: "https://yyu.edu.tr/" }
        ].sort((a, b) => a.name.localeCompare(b.name));

        const TITLES = ["ArÅŸ. GÃ¶r.", "Ã–ÄŸr. GÃ¶r.", "Dr. Ã–ÄŸr. Ãœyesi", "DoÃ§. Dr.", "Prof. Dr."];

        const ACADEMIC_DATA = {
            "default": [
                { id: 1, event: "GÃ¼z BaÅŸlangÄ±cÄ±", date: "2024-09-23", category: "academic" },
                { id: 2, event: "Vize HaftasÄ±", date: "2024-11-16", category: "academic" },
                { id: 3, event: "Final HaftasÄ±", date: "2025-01-06", category: "academic" },
                { id: 4, event: "Bahar BaÅŸlangÄ±cÄ±", date: "2025-02-17", category: "academic" },
                { id: 5, event: "DoÃ§entlik (Mart)", date: "2025-03-20", type: "critical", category: "academic" },
                { id: 6, event: "DoÃ§entlik (Ekim)", date: "2025-10-20", type: "critical", category: "academic" }
            ]
        };

        const LESSON_TYPES = {
            "lisans": { label: "Lisans", className: "lesson-lisans", btnClass: "btn-lisans", tag: "L" },
            "yuksek": { label: "Y. Lisans", className: "lesson-yuksek", btnClass: "btn-yuksek", tag: "YL" },
            "doktora": { label: "Doktora", className: "lesson-doktora", btnClass: "btn-doktora", tag: "DR" },
            "seminer": { label: "Seminer", className: "lesson-seminer", btnClass: "btn-seminer", tag: "SEM" }
        };

        const App = () => {
            const [user, setUser] = useState(() => safeGet('user_v44', null));
            const [tasks, setTasks] = useState(() => safeGet('tasks_v44', []));
            const [schedule, setSchedule] = useState(() => safeGet('schedule_v44', {
                Pazartesi: Array(13).fill(null), Sali: Array(13).fill(null), Carsamba: Array(13).fill(null), Persembe: Array(13).fill(null), Cuma: Array(13).fill(null), Cumartesi: Array(13).fill(null), Pazar: Array(13).fill(null)
            }));
            const [timeSlots, setTimeSlots] = useState(() => safeGet('timeslots_v44', ["08:00", "09:00", "10:00", "11:00", "12:00", "13:00", "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00"]));
            const [customScores, setCustomScores] = useState(() => safeGet('scores_v44', [{ id: 1, name: "Makale", value: 20, count: 0 }]));
            const [targetScore, setTargetScore] = useState(() => safeGet('target_score_v44', 100));
            const [notes, setNotes] = useState(() => safeGet('notes_v44', []));
            const [calendarEvents, setCalendarEvents] = useState(() => safeGet('calendar_v44', ACADEMIC_DATA['default']));
            
            const [view, setView] = useState("flow");
            
            // Modal System
            const [activeModal, setActiveModal] = useState(null); 
            const [selectedNode, setSelectedNode] = useState(null);
            const [isScreenshotMode, setIsScreenshotMode] = useState(false);
            const [alertState, setAlertState] = useState(null); 
            const [conflictWarn, setConflictWarn] = useState(null);
            const [dismissedAlerts, setDismissedAlerts] = useState([]);
            
            const [editingTask, setEditingTask] = useState(null);
            const [newTask, setNewTask] = useState({ title: "", date: "", time: "", desc: "", type: "task", category: "daily" });
            const [newNote, setNewNote] = useState("");
            const [isRecurring, setIsRecurring] = useState(false);
            const [recurringWeeks, setRecurringWeeks] = useState(14);
            const [editingLesson, setEditingLesson] = useState(null);
            const [dayDetailData, setDayDetailData] = useState(null);
            
            const [prayerTimes, setPrayerTimes] = useState(null);
            const [progress, setProgress] = useState(0);
            const [currentTimeStr, setCurrentTimeStr] = useState("00:00");
            const [timeRange, setTimeRange] = useState({ start: 6, end: 23 });
            const [cursorColor, setCursorColor] = useState("bg-emerald-500 shadow-[0_0_10px_#10b981]");
            const [pomodoro, setPomodoro] = useState({ active: false, time: 25 * 60 });
            
            const fileInputRef = useRef(null);
            const audioRef = useRef(null);
            const [currentTime, setCurrentTime] = useState(new Date());

            useEffect(() => { localStorage.setItem('user_v44', JSON.stringify(user)); }, [user]);
            useEffect(() => { localStorage.setItem('tasks_v44', JSON.stringify(tasks)); }, [tasks]);
            useEffect(() => { localStorage.setItem('schedule_v44', JSON.stringify(schedule)); }, [schedule]);
            useEffect(() => { localStorage.setItem('notes_v44', JSON.stringify(notes)); }, [notes]);
            useEffect(() => { localStorage.setItem('calendar_v44', JSON.stringify(calendarEvents)); }, [calendarEvents]);
            useEffect(() => { localStorage.setItem('scores_v44', JSON.stringify(customScores)); }, [customScores]);
            useEffect(() => { localStorage.setItem('target_score_v44', JSON.stringify(targetScore)); }, [targetScore]);

            const getMinutes = (timeStr) => { if(!timeStr) return 0; const [h, m] = timeStr.split(':').map(Number); return h * 60 + m; };
            const getDayKey = (dateStr) => { const d = new Date(dateStr); const map = ["Pazar", "Pazartesi", "Sali", "Carsamba", "Persembe", "Cuma", "Cumartesi"]; return map[d.getDay()]; };
            const getUrgencyStatus = (taskTimeStr) => {
                const now = new Date(); const currentMinutes = now.getHours() * 60 + now.getMinutes(); const eventMinutes = getMinutes(taskTimeStr);
                if (currentMinutes > eventMinutes) return 'past';
                const diff = eventMinutes - currentMinutes;
                if (diff <= 60) return 'urgent'; if (diff <= 120) return 'soon'; return 'safe';
            };

            const checkConflict = (date, time) => {
                const taskExists = tasks.find(t => t.date === date && t.time === time && t.id !== editingTask?.id);
                if (taskExists) return `Ã‡akÄ±ÅŸma: "${taskExists.title}"`;
                const dayKey = getDayKey(date);
                const daySchedule = schedule[dayKey];
                if (daySchedule) {
                    const taskMin = getMinutes(time);
                    for(let i=0; i<daySchedule.length; i++) {
                        if(daySchedule[i]) {
                            const slotTime = timeSlots[i];
                            const slotMin = getMinutes(slotTime);
                            const duration = daySchedule[i].duration || 1;
                            if (taskMin >= slotMin && taskMin < slotMin + (duration * 60)) return `Ã‡akÄ±ÅŸma: "${daySchedule[i].name}" dersi!`;
                        }
                    }
                }
                return null;
            };

            const getTimelineEvents = useCallback(() => {
                const now = new Date();
                const nowMinTotal = now.getHours() * 60 + now.getMinutes();
                const windowStart = nowMinTotal - (12 * 60); const windowEnd = nowMinTotal + (12 * 60);
                let events = [];
                tasks.forEach(t => {
                    const tDate = new Date(t.date); const tMin = getMinutes(t.time); const diffDays = Math.round((tDate.setHours(0,0,0,0) - new Date().setHours(0,0,0,0)) / (1000*60*60*24));
                    let relativeMin = tMin + (diffDays * 1440);
                    if (relativeMin >= windowStart && relativeMin <= windowEnd) events.push({ ...t, relativeMin, displayType: t.category });
                });
                if (prayerTimes && user?.enablePrayer) {
                    const map = { Fajr: "Ä°msak", Sunrise: "GÃ¼neÅŸ", Dhuhr: "Ã–ÄŸle", Asr: "Ä°kindi", Maghrib: "AkÅŸam", Isha: "YatsÄ±" };
                    [-1, 0, 1].forEach(dayOffset => {
                        Object.keys(map).forEach(k => {
                            if(prayerTimes[k]) {
                                const tMin = getMinutes(prayerTimes[k]) + (dayOffset * 1440);
                                if (tMin >= windowStart && tMin <= windowEnd) events.push({ id: `p-${k}-${dayOffset}`, title: map[k], time: prayerTimes[k], relativeMin: tMin, displayType: "prayer", desc: dayOffset === 0 ? "BugÃ¼n" : (dayOffset === 1 ? "YarÄ±n" : "DÃ¼n") });
                            }
                        });
                    });
                }
                [-1, 0, 1].forEach(dayOffset => {
                    const d = new Date(); d.setDate(d.getDate() + dayOffset);
                    const dayKey = ["Pazar", "Pazartesi", "Sali", "Carsamba", "Persembe", "Cuma", "Cumartesi"][d.getDay()];
                    const dayLessons = schedule[dayKey];
                    if (dayLessons) {
                        dayLessons.forEach((l, i) => {
                            if (l) {
                                const tMin = getMinutes(timeSlots[i]) + (dayOffset * 1440);
                                if (tMin >= windowStart && tMin <= windowEnd) events.push({ id: `l-${dayOffset}-${i}`, title: l.name, time: timeSlots[i], relativeMin: tMin, displayType: "class", lType: l.type, desc: LESSON_TYPES[l.type].label });
                            }
                        });
                    }
                });
                return events.sort((a, b) => a.relativeMin - b.relativeMin);
            }, [tasks, prayerTimes, user, schedule, timeSlots]);

            const getTimelineList = () => {
                const events = getTimelineEvents();
                const nowMin = new Date().getHours() * 60 + new Date().getMinutes();
                return events.filter(e => e.relativeMin >= nowMin).slice(0, 20); 
            };

            useEffect(() => {
                const tick = () => {
                    const now = new Date(); setCurrentTime(now);
                    setCurrentTimeStr(now.toLocaleTimeString('tr-TR', {hour:'2-digit', minute:'2-digit'}));
                    
                    const events = getTimelineEvents();
                    const nowTotalMin = now.getHours() * 60 + now.getMinutes();

                    // Cursor Color
                    const nextEvent = events.find(ev => ev.relativeMin > nowTotalMin && ev.displayType !== 'prayer');
                    if (nextEvent) {
                        const diff = nextEvent.relativeMin - nowTotalMin;
                        if (diff <= 60) setCursorColor("bg-red-500 shadow-[0_0_15px_red]");
                        else if (diff <= 120) setCursorColor("bg-yellow-500 shadow-[0_0_10px_yellow]");
                        else setCursorColor("bg-emerald-500 shadow-[0_0_10px_#10b981]");
                    } else setCursorColor("bg-emerald-500 shadow-[0_0_10px_#10b981]");

                    setProgress(50); // Center

                    // Alarm
                    const upcoming = events.find(ev => {
                        const diff = ev.relativeMin - nowTotalMin;
                        return diff > 0 && diff <= 5 && ev.displayType !== 'prayer';
                    });
                    if (upcoming && !dismissedAlerts.includes(upcoming.id)) {
                        if (!alertState || alertState.id !== upcoming.id) {
                            setAlertState(upcoming);
                            try{ audioRef.current.play(); } catch(e){}
                        }
                    } else { if(alertState) setAlertState(null); }

                    if(pomodoro.active && pomodoro.time > 0) setPomodoro(prev => ({...prev, time: prev.time - 1}));
                    else if (pomodoro.active && pomodoro.time === 0) { setPomodoro({active: false, time: 25 * 60}); alert("Odaklanma Bitti!"); }
                };
                tick(); const timer = setInterval(tick, 1000); 
                if (user?.enablePrayer && user?.city && !prayerTimes) fetchPrayerTimes(user.city);
                return () => clearInterval(timer);
            }, [getTimelineEvents, alertState, pomodoro.active, user, dismissedAlerts]);

            const dismissAlert = () => { if (alertState) { setDismissedAlerts(prev => [...prev, alertState.id]); setAlertState(null); if(audioRef.current) { audioRef.current.pause(); audioRef.current.currentTime = 0; } } };
            const fetchPrayerTimes = async (city) => { try { const d = new Date(); const res = await fetch(`https://api.aladhan.com/v1/timingsByCity/${d.getDate()}-${d.getMonth()+1}-${d.getFullYear()}?city=${city}&country=Turkey&method=13`); const json = await res.json(); if(json.data) setPrayerTimes(json.data.timings); } catch (e) { console.error(e); } };
            const updateAcademicCalendar = (uniName) => { const newData = ACADEMIC_DATA[uniName] || ACADEMIC_DATA['default']; setCalendarEvents(newData); };
            const handleUpdateUser = (e) => { e.preventDefault(); const fd = new FormData(e.target); const u = UNIVERSITIES.find(x => x.name === fd.get('uni')); if (!u) return; updateAcademicCalendar(u.name); setUser({ ...user, title: fd.get('title'), name: fd.get('name'), uni: u.name, city: u.city, url: u.url, enablePrayer: fd.get('enablePrayer') === 'on' }); setActiveModal(null); };
            
            const handleAddTask = () => { 
                if(!newTask.title || !newTask.date) return;
                if (!conflictWarn) {
                    let msg = checkConflict(newTask.date, newTask.time);
                    if (isRecurring && !editingTask) { 
                        const d = new Date(newTask.date);
                        const check = checkConflict(d.toISOString().split('T')[0], newTask.time);
                        if(check) msg = "Rutin BaÅŸlangÄ±cÄ±nda: " + check;
                    }
                    if (msg) { setConflictWarn(msg); return; }
                }

                if (editingTask) {
                    setTasks(prev => prev.map(t => t.id === editingTask.id ? { ...newTask, id: t.id } : t));
                    setEditingTask(null);
                } else {
                    let newTasks = []; 
                    if (isRecurring) { 
                        let currentDate = new Date(newTask.date); 
                        for(let i=0; i<recurringWeeks; i++) { 
                            newTasks.push({...newTask, id: Date.now()+i, date: currentDate.toISOString().split('T')[0]}); 
                            currentDate.setDate(currentDate.getDate() + 7); 
                        } 
                    } else { newTasks.push({...newTask, id: Date.now()}); } 
                    setTasks(prev => [...prev, ...newTasks]); 
                }
                
                setActiveModal(null); setConflictWarn(null); setNewTask({title:"", date:"", time:"", desc:"", type:"task", category:"daily"}); setIsRecurring(false);
            };

            const openEditTask = (task) => {
                setNewTask(task);
                setEditingTask(task);
                setActiveModal('task');
                setConflictWarn(null);
            };

            const deleteTask = (e, id) => { 
                e.stopPropagation();
                if(confirm("GÃ¶revi silmek istediÄŸinize emin misiniz?")) { 
                    setTasks(prev => prev.filter(t => t.id !== id)); 
                    if (dayDetailData) { setDayDetailData(prev => ({...prev, events: prev.events.filter(ev => ev.id !== id)})); }
                } 
            };

            const handleAddNote = () => { if(!newNote) return; setNotes([{id: Date.now(), text: newNote, date: new Date().toLocaleDateString()}, ...notes]); setNewNote(""); };
            const exportData = () => { const data = JSON.stringify({ user, tasks, schedule, customScores, targetScore, notes }, null, 2); const blob = new Blob([data], {type: "text/plain"}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = `akademik_yedek.txt`; a.click(); };
            const importData = () => { const input = document.createElement('input'); input.type = 'file'; input.accept = '.txt,.json'; input.onchange = (e) => { const file = e.target.files[0]; const reader = new FileReader(); reader.onload = (ev) => { try { const data = JSON.parse(ev.target.result); if(data.user) setUser(data.user); if(data.tasks) setTasks(data.tasks); if(data.schedule) setSchedule(data.schedule); if(data.customScores) setCustomScores(data.customScores); if(data.notes) setNotes(data.notes); alert("Yedek yÃ¼klendi!"); window.location.reload(); } catch(err) { alert("Hata! Dosya bozuk."); } }; reader.readAsText(file); }; input.click(); };
            const handleFileUpload = (e) => { const file = e.target.files[0]; if (!file) return; const reader = new FileReader(); reader.onload = (e) => { const content = e.target.result; const lines = content.split(/\r\n|\n|\r/); let events = []; let currentEvent = null; lines.forEach(line => { if (line.startsWith('BEGIN:VEVENT')) currentEvent = {}; else if (line.startsWith('END:VEVENT')) { if (currentEvent && currentEvent.SUMMARY && currentEvent.DTSTART) { const rawDate = currentEvent.DTSTART.replace('VALUE=DATE:',''); const y = rawDate.substring(0,4); const m = rawDate.substring(4,6); const d = rawDate.substring(6,8); const h = rawDate.length > 8 ? rawDate.substring(9,11) : "08"; const min = rawDate.length > 8 ? rawDate.substring(11,13) : "00"; events.push({ id: Date.now() + Math.random(), title: currentEvent.SUMMARY, date: `${y}-${m}-${d}`, time: `${h}:${min}`, desc: "Takvimden", type: "task", category: "official", origin: "imported" }); } currentEvent = null; } else if (currentEvent) { const [key, val] = line.split(':'); if(key) currentEvent[key.split(';')[0]] = val; } }); setTasks([...tasks, ...events]); alert(`${events.length} etkinlik eklendi.`); }; reader.readAsText(file); };
            const handleDayClick = (dateStr, events) => { if (events.length > 0) { setDayDetailData({date: dateStr, events}); setActiveModal('dayDetail'); } else { setNewTask({ title: "", date: dateStr, time: "09:00", desc: "", type: "task", category: "daily" }); setActiveModal('task'); } };
            const getAllEvents = () => { const academicEvents = calendarEvents.map(e => ({ ...e, origin: 'academic', title: e.event, category: 'academic' })); const userEvents = tasks.map(t => ({ ...t, event: t.title, origin: t.origin || 'personal', category: t.category })); return [...academicEvents, ...userEvents]; };
            const saveLesson = () => { const { day, index, data } = editingLesson; const newSchedule = { ...schedule }; const duration = parseInt(data.duration) || 1; if (index + duration > 13) { alert("Ders gÃ¼nÃ¼n bitiÅŸ saatini aÅŸÄ±yor!"); return; } const batchId = data.batchId || Date.now(); for (let i = 0; i < duration; i++) { newSchedule[day][index + i] = { ...data, duration: 1, batchId: batchId }; } setSchedule(newSchedule); setActiveModal(null); };
            const deleteLesson = () => { const { day, index, data } = editingLesson; if (!data) { setActiveModal(null); return; } const newSchedule = { ...schedule }; if (data.batchId) { if (confirm(`"${data.name}" dersinin tÃ¼mÃ¼nÃ¼ sil?`)) { Object.keys(newSchedule).forEach(d => { newSchedule[d] = newSchedule[d].map(l => (l && l.batchId === data.batchId) ? null : l); }); } else { newSchedule[day][index] = null; } } else { newSchedule[day][index] = null; } setSchedule(newSchedule); setActiveModal(null); };

            const renderTimelineBar = () => {
                const events = getTimelineEvents(); const nowMin = currentTime.getHours() * 60 + currentTime.getMinutes(); const windowStart = nowMin - (12 * 60); const windowTotal = 1440; 
                return (
                    <div className="h-16 relative w-full overflow-hidden flex items-center bg-slate-900 rounded-xl border border-slate-700 shadow-inner">
                        <div className="absolute top-1/2 left-0 w-full h-px bg-slate-600/50"></div>
                        <div className={`absolute top-0 bottom-0 w-1 z-30 left-1/2 transition-colors duration-500 ${cursorColor}`}></div>
                        {events.map(ev => {
                            let diff = ev.relativeMin - nowMin; const positionPct = 50 + (diff / (12*60)) * 50; 
                            if (positionPct < 0 || positionPct > 100) return null;
                            
                            // RENKLER (DÃœÄžÃœMLER)
                            let nodeColor = "bg-gray-500"; 
                            if (ev.displayType === 'prayer') nodeColor = "bg-white w-0.5 h-full rounded-none top-0 translate-y-0";
                            else if (ev.displayType === 'class') nodeColor = "bg-emerald-500 w-3 h-3 rounded-full border-2 border-slate-900"; // YEÅžÄ°L (DÃœZELTÄ°LDÄ°)
                            else if (ev.displayType === 'daily') nodeColor = "bg-blue-500 w-3 h-3 rounded-full border-2 border-slate-900"; 
                            else if (ev.displayType === 'official') nodeColor = "bg-amber-500 w-3 h-3 rounded-full border-2 border-slate-900"; 
                            else if (ev.displayType === 'special') nodeColor = "bg-pink-500 w-3 h-3 rounded-full border-2 border-slate-900"; 
                            else if (ev.displayType === 'task') nodeColor = "bg-blue-500 w-3 h-3 rounded-full border-2 border-slate-900";

                            let pulseClass = ""; if (diff > 0 && diff < 120 && ev.displayType !== 'prayer') pulseClass = "animate-pulse scale-125"; 
                            return (<div key={ev.id} className={`absolute top-1/2 -translate-y-1/2 z-20 cursor-pointer ${nodeColor} ${pulseClass}`} style={{left: `${positionPct}%`}} onClick={() => { if(ev.displayType!=='prayer'&&ev.displayType!=='class') openEditTask(ev); else setSelectedNode(ev); }}></div>);
                        })}
                    </div>
                );
            };

            const totalCalculated = customScores.reduce((acc, curr) => acc + ( (parseInt(curr.value)||0) * (parseInt(curr.count)||0) ), 0);
            const appClass = isScreenshotMode ? "screenshot-mode bg-white min-h-screen text-black" : "max-w-md mx-auto min-h-screen bg-[#0f172a] pb-24 relative shadow-2xl overflow-hidden text-slate-100";

            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6 bg-[#0f172a]">
                        <div className="w-full max-w-md glass p-8 rounded-2xl shadow-2xl">
                            <h1 className="text-2xl font-bold text-white mb-2 text-center">Akademik Asistan</h1>
                            <p className="text-center text-slate-400 mb-6 text-sm">V44 â€¢ Final OnarÄ±m</p>
                            <form onSubmit={(e) => { e.preventDefault(); const fd = new FormData(e.target); const u = UNIVERSITIES.find(x => x.name === fd.get('uni')); if (!u) return; setUser({ title: fd.get('title'), name: fd.get('name'), uni: u.name, city: u.city, url: u.url, enablePrayer: fd.get('enablePrayer') === 'on' }); }} className="space-y-4">
                                <select name="title" className="w-full input-dark p-3 rounded-lg">{TITLES.map(t=><option key={t} value={t}>{t}</option>)}</select>
                                <input name="name" required placeholder="Ad Soyad" className="w-full input-dark p-3 rounded-lg" />
                                <select name="uni" className="w-full input-dark p-3 rounded-lg">{UNIVERSITIES.map(u => <option key={u.name} value={u.name}>{u.name}</option>)}</select>
                                <div className="flex items-center gap-3 pt-2"><input type="checkbox" name="enablePrayer" defaultChecked className="w-5 h-5 accent-blue-500" /><span className="text-sm text-slate-300">Namaz Vakitlerini GÃ¶ster</span></div>
                                <button className="w-full bg-blue-600 text-white font-bold py-4 rounded-xl mt-2 hover:bg-blue-500 transition">BAÅžLAT</button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className={appClass} onClick={() => isScreenshotMode && setIsScreenshotMode(false)}>
                    <audio ref={audioRef} src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>
                    {alertState && !isScreenshotMode && (<div className="fixed inset-0 z-[100] flex items-center justify-center bg-red-900/95 backdrop-blur-md animate-flash"><div className="bg-white text-red-700 p-6 rounded-3xl shadow-2xl text-center max-w-sm mx-4 transform scale-110"><i className="fas fa-exclamation-triangle text-6xl mb-4 animate-bounce"></i><h1 className="text-3xl font-bold mb-1">DÄ°KKAT!</h1><p className="text-2xl font-bold text-black mb-2">{alertState.time}</p><p className="text-lg font-semibold">{alertState.title}</p><button onClick={dismissAlert} className="mt-6 w-full bg-red-600 text-white py-3 rounded-xl font-bold hover:bg-red-700 transition shadow-lg">TAMAM, ANLAÅžILDI</button></div></div>)}
                    <div className="pt-10 pb-6 px-6 bg-gradient-to-br from-blue-900 via-slate-900 to-slate-900 rounded-b-[40px] shadow-lg border-b border-blue-900/30 no-print z-20 relative no-screenshot"><div className="absolute top-3 right-5 text-white/50 text-[10px] tracking-tighter signature z-50 leading-none pointer-events-none">Ã–mer Faruk Erdem</div><div className="flex justify-between items-start"><div><h2 className="text-xl font-bold text-white">{user.name}</h2><div className="text-xs text-blue-300 mt-1">{user.title}</div></div><button onClick={() => setActiveModal('settings')} className="w-8 h-8 rounded-full bg-slate-800 text-slate-400 flex items-center justify-center hover:text-blue-400"><i className="fas fa-cog text-xs"></i></button></div><div className="mt-6 relative"><div className="flex justify-between text-[10px] text-blue-200 font-mono mb-1"><span>-12s</span><span className="animate-pulse text-white font-bold">{currentTimeStr}</span><span>+12s</span></div>{renderTimelineBar()}{selectedNode && (<div className="mt-2 bg-slate-800 p-2 rounded border border-slate-600 text-xs flex justify-between items-center animate-enter"><span><span className="font-bold text-blue-300">{selectedNode.time}</span> - {selectedNode.title}</span><button onClick={() => setSelectedNode(null)}><i className="fas fa-times"></i></button></div>)}</div></div>

                    <div className="p-4 space-y-4 no-screenshot">
                        {view === 'flow' && (<div className="animate-enter space-y-3"><h3 className="text-sm font-bold text-slate-400 uppercase border-b border-slate-700 pb-2 mb-4 ml-1">GÃ¼nlÃ¼k AkÄ±ÅŸ (YaklaÅŸan)</h3>{getTimelineList().length === 0 ? <div className="text-center py-12 opacity-30 text-sm border-2 border-dashed border-slate-700 rounded-xl">AkÄ±ÅŸ boÅŸ.</div> : getTimelineList().map((item, i) => { 
                            let borderClass = 'border-slate-600 opacity-50'; 
                            if (item.displayType === 'prayer') borderClass = 'border-white'; 
                            else if (item.displayType === 'daily' || item.displayType === 'task') borderClass = 'border-blue-500'; 
                            else if (item.displayType === 'official') borderClass = 'border-amber-500'; 
                            else if (item.displayType === 'special') borderClass = 'border-pink-500';
                            else if (item.displayType === 'class') borderClass = 'border-teal-500'; 
                            return (
                                <div key={i} onClick={() => { if(item.displayType!=='prayer'&&item.displayType!=='class') openEditTask(item) }} className={`glass p-3 rounded-lg flex items-center gap-4 border-l-2 ${borderClass} cursor-pointer hover:bg-white/5`}>
                                    <div className="text-center min-w-[50px] font-mono font-bold text-lg text-slate-300">{item.time}</div>
                                    <div className="flex-1"><div className="flex items-center gap-2"><div className="font-bold text-sm text-white">{item.title}</div></div><div className="text-xs text-slate-500">{item.desc}</div></div>
                                    {item.displayType !== 'prayer' && item.displayType !== 'class' && <button onClick={(e) => deleteTask(e, item.id)} className="text-red-400 hover:text-red-300 p-2 z-10"><i className="fas fa-trash"></i></button>}
                                </div>
                            ) 
                        })}</div>)}
                        {view === 'home' && (<div className="animate-enter space-y-4">{user.url && (<button onClick={() => setView('annual')} className="w-full bg-slate-800 border border-slate-600 text-blue-300 p-4 rounded-xl flex items-center justify-between hover:bg-slate-700 transition shadow-lg mb-2"><div className="flex items-center gap-4"><div className="w-10 h-10 rounded-full bg-red-900/50 flex items-center justify-center text-white text-xl"><i className="fas fa-calendar-alt"></i></div><div className="text-left"><div className="text-xs text-slate-400">Ãœniversite Paneli</div><div className="text-base font-bold text-white">ðŸ“… Akademik Takvimi GÃ¶r</div></div></div><i className="fas fa-chevron-right opacity-50"></i></button>)}<div className="grid grid-cols-2 gap-4"><button onClick={() => { const today = new Date().toISOString().split('T')[0]; setNewTask({title:"", date:today, time:"", desc:"", type:"task", category:"daily"}); setActiveModal('task'); setConflictWarn(null); }} className="bg-gradient-to-br from-blue-600 to-blue-700 text-white p-6 rounded-xl flex flex-col items-center justify-center gap-2 shadow-lg active:scale-95 transition"><i className="fas fa-bell text-2xl"></i><span className="font-bold text-xs tracking-wide">HATIRLATICI</span></button><button onClick={() => setActiveModal('notes')} className="bg-slate-700 text-white p-6 rounded-xl flex flex-col items-center justify-center gap-2 border border-slate-600 shadow-lg active:scale-95 transition"><i className="fas fa-sticky-note text-2xl text-yellow-400"></i><span className="font-bold text-xs tracking-wide">NOT DEFTERÄ°</span></button></div><button onClick={() => setView('schedule')} className="w-full bg-slate-800 p-4 rounded-xl flex items-center justify-between border border-slate-700 hover:bg-slate-700 transition shadow-lg"><span className="font-bold text-sm">HaftalÄ±k Ders ProgramÄ±</span><i className="fas fa-chevron-right text-slate-500"></i></button></div>)}
                        {view === 'annual' && (<div className="animate-enter pb-16"><div className="flex justify-between items-center mb-4"><h3 className="text-slate-300 font-bold text-sm uppercase">YÄ±llÄ±k Takvim</h3><div className="flex gap-2"><button onClick={() => window.open(user.url, '_blank')} className="text-[10px] bg-red-900 px-3 py-1.5 rounded border border-red-700 hover:text-white transition">Ãœni. Web</button><button onClick={() => fileInputRef.current.click()} className="text-[10px] bg-slate-800 px-3 py-1.5 rounded border border-slate-700 hover:border-blue-500 hover:text-white transition">ICS YÃ¼kle</button><input type="file" ref={fileInputRef} onChange={handleFileUpload} className="hidden" accept=".ics" /></div></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">{Array.from({length: 12}, (_, i) => i).map(monthIdx => { const year = new Date().getFullYear(); const date = new Date(year, monthIdx, 1); const monthName = date.toLocaleString('tr-TR', { month: 'long' }); const daysInMonth = new Date(year, monthIdx + 1, 0).getDate(); const startDay = new Date(year, monthIdx, 1).getDay(); const offset = startDay === 0 ? 6 : startDay - 1; const today = new Date(); const isCurrentMonth = today.getMonth() === monthIdx && today.getFullYear() === year; const currentDay = today.getDate(); return (<div key={monthIdx} className="glass rounded-lg border border-slate-700 overflow-hidden"><div className="bg-slate-800 p-2 text-center font-bold text-blue-200 text-xs uppercase">{monthName}</div><div className="grid grid-cols-7 text-[9px] text-slate-500 text-center py-1 bg-slate-900/30"><span>Pt</span><span>Sa</span><span>Ã‡a</span><span>Pe</span><span>Cu</span><span>Ct</span><span>Pa</span></div><div className="grid grid-cols-7 gap-px bg-slate-800 p-px">{Array(offset).fill(null).map((_,k)=><div key={`e-${k}`} className="bg-slate-900 h-6"></div>)}{Array(daysInMonth).fill(null).map((_,k)=>{ const d = k+1; const dStr = `${year}-${String(monthIdx+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`; const events = getAllEvents().filter(e => e.date === dStr); let bg = "bg-slate-900 hover:bg-slate-700"; let text = "text-slate-500"; if (isCurrentMonth && d === currentDay) { bg = "bg-cyan-500 shadow-lg shadow-cyan-500/50 z-10 scale-110 rounded"; text = "text-white font-bold"; } else if(events.some(e => e.category === 'academic')) { bg = "bg-red-900"; text = "text-white font-bold"; } else if(events.some(e => e.category === 'special')) { bg = "bg-pink-700"; text = "text-white font-bold"; } else if(events.some(e => e.category === 'official')) { bg = "bg-amber-700"; text = "text-white font-bold"; } else if(events.some(e => e.category === 'daily')) { bg = "bg-blue-900"; text = "text-white font-bold"; } return (<button key={d} onClick={() => handleDayClick(dStr, events)} className={`h-6 flex items-center justify-center text-[9px] ${bg} ${text}`}>{d}</button>) })}</div></div>) })}</div></div>)}
                        {view === 'schedule' && (<div className="animate-enter glass rounded-xl overflow-hidden border border-slate-700"><div className="p-3 bg-slate-800/50 flex justify-between items-center no-screenshot"><div className="text-xs font-bold text-slate-400 uppercase">HaftalÄ±k Program</div><button onClick={() => setIsScreenshotMode(true)} className="bg-blue-600 text-white px-3 py-1.5 rounded text-[10px] font-bold hover:bg-blue-500 flex items-center gap-1"><i className="fas fa-camera"></i> Ekran GÃ¶rÃ¼ntÃ¼sÃ¼ Modu</button></div><div className="overflow-x-auto"><table className="w-full text-xs border-collapse"><thead className="bg-slate-900 text-slate-400"><tr><th className="p-2 w-16 border border-slate-800 text-center">Saat</th>{Object.keys(schedule).map(d=><th key={d} className="p-2 min-w-[80px] border border-slate-800 text-center">{d.substring(0,3)}</th>)}</tr></thead><tbody className="divide-y divide-slate-800">{timeSlots.map((t, i) => (<tr key={i} className="hover:bg-white/5"><td className="p-1 border border-slate-800 text-center"><input type="time" className="w-full bg-transparent text-center text-slate-500 rounded p-1 focus:text-white outline-none font-mono" value={t} onChange={e=>{const n=[...timeSlots];n[i]=e.target.value;setTimeSlots(n)}} /></td>{Object.keys(schedule).map(d => { const l = schedule[d][i]; return (<td key={d} className="p-1 border border-slate-800 h-12 relative cursor-pointer" onClick={() => { if(!isScreenshotMode){ setEditingLesson({day:d, index:i, data:l||{name:"",type:"lisans", duration: 1}}); setActiveModal('lesson'); } }}>{l ? <div className={`w-full h-full rounded flex items-center justify-center text-center p-1 text-[9px] font-light shadow-sm ${LESSON_TYPES[l.type].className}`} style={{lineHeight:'1.1'}}><span>{l.name}</span></div> : <div className="w-full h-full hover:bg-white/5 rounded"></div>}</td>)})}</tr>))}</tbody></table></div></div>)}
                        {view === 'promotion' && (<div className="animate-enter pb-20"><div className="glass p-4 rounded-xl border border-blue-500/20"><div className="flex justify-between items-center mb-4"><h3 className="font-bold text-slate-300 text-sm">PUAN CETVELÄ°</h3><button onClick={() => setCustomScores([...customScores, {id:Date.now(), name:"", value:0, count:0}])} className="text-[10px] bg-blue-600 text-white px-3 py-1.5 rounded hover:bg-blue-500"><i className="fas fa-plus mr-1"></i>Ekle</button></div><div className="grid grid-cols-12 gap-1 text-[9px] text-slate-500 uppercase font-bold px-1 mb-2"><div className="col-span-5">Faaliyet</div><div className="col-span-2 text-center">Puan</div><div className="col-span-2 text-center">Adet</div><div className="col-span-2 text-center">Top.</div><div className="col-span-1"></div></div><div className="space-y-2">{customScores.map(s => (<div key={s.id} className="grid grid-cols-12 gap-2 items-center bg-slate-900/50 p-2 rounded border border-slate-700"><div className="col-span-5"><input className="w-full bg-transparent text-sm text-slate-200 focus:outline-none placeholder-slate-600" placeholder="Faaliyet" value={s.name} onChange={e=>setCustomScores(customScores.map(x=>x.id===s.id?{...x,name:e.target.value}:x))} /></div><div className="col-span-2"><input type="number" className="w-full bg-slate-900 text-center text-xs text-slate-400 rounded p-1" value={s.value} onChange={e=>setCustomScores(customScores.map(x=>x.id===s.id?{...x,value:e.target.value}:x))} /></div><div className="col-span-2"><input type="number" className="w-full bg-slate-900 text-center text-xs text-white font-bold rounded p-1 border border-slate-600" value={s.count} onChange={e=>setCustomScores(customScores.map(x=>x.id===s.id?{...x,count:e.target.value}:x))} /></div><div className="col-span-2 text-center text-xs font-bold text-blue-400">{(parseInt(s.value)||0) * (parseInt(s.count)||0)}</div><div className="col-span-1 text-right"><button onClick={()=>setCustomScores(customScores.filter(x=>x.id!==s.id))} className="text-slate-600 hover:text-red-400"><i className="fas fa-trash-alt"></i></button></div></div>))}</div><div className="mt-6 bg-slate-900 p-4 rounded-xl border border-slate-700 shadow-xl"><div className="flex justify-between items-center mb-4"><span className="text-xs text-slate-400 uppercase font-bold">Hedef Puan:</span><input type="number" className="w-20 bg-slate-900 border border-slate-600 rounded p-1 text-center text-sm font-bold text-white focus:border-blue-500 outline-none" value={targetScore} onChange={e => setTargetScore(parseInt(e.target.value)||0)} /></div><div className="flex justify-between text-sm font-bold mb-2"><span className="text-slate-300">MEVCUT</span><span className={totalCalculated>=targetScore?"text-emerald-400":"text-rose-400"}>{totalCalculated} / {targetScore}</span></div><div className="h-3 bg-slate-900 rounded-full overflow-hidden mb-2 border border-slate-700/50"><div className={`h-full transition-all duration-1000 ${totalCalculated>=targetScore?'bg-emerald-500':'bg-gradient-to-r from-blue-600 to-red-600'}`} style={{width: `${Math.min((totalCalculated/targetScore)*100, 100)}%`}}></div></div></div></div></div>)}
                    </div>

                    {isScreenshotMode && (<div className="printable-content text-black h-screen p-8 bg-white fixed top-0 left-0 w-full z-[100] overflow-auto"><div className="text-center mb-6 border-b-2 border-black pb-4"><h1 className="text-3xl font-bold text-black uppercase tracking-wide">{user.name}</h1><p className="text-lg text-gray-700 mt-1">{user.uni} â€¢ {user.title}</p><p className="text-xs text-gray-400 mt-1 signature">Ã–mer Faruk Erdem</p></div><div className="w-full"><h2 className="text-xl font-bold mb-4 text-center underline">HAFTALIK DERS PROGRAMI</h2><table className="w-full text-xs border-collapse"><thead><tr><th className="p-3 border border-black bg-gray-100 font-bold text-sm">Saat</th>{Object.keys(schedule).map(d => <th key={d} className="p-3 border border-black bg-gray-100 font-bold text-sm">{d}</th>)}</tr></thead><tbody>{timeSlots.map((t, i) => (<tr key={i}><td className="p-2 border border-black text-center font-bold bg-gray-50">{t}</td>{Object.keys(schedule).map(d => { const l = schedule[d][i]; return (<td key={d} className="p-1 border border-black h-12 text-center relative">{l && (<div className={`text-[10px] font-bold p-2 h-full flex flex-col items-center justify-center ${LESSON_TYPES[l.type].className}`} style={{border: '1px solid black', color: 'white'}}><span>{l.name}</span></div>)}</td>)})}</tr>))}</tbody></table></div><div className="mt-10 text-center text-sm text-gray-400 italic">(Moddan Ã§Ä±kmak iÃ§in ekrana dokunun)</div></div>)}

                    <div className="fixed bottom-0 w-full max-w-md bg-slate-900/95 backdrop-blur border-t border-slate-800 flex justify-around py-4 pb-8 z-50 no-screenshot">
                        {[{id: 'flow', icon: 'stream', label: 'AkÄ±ÅŸ'},{id: 'home', icon: 'home', label: 'Ana Sayfa'},{id: 'schedule', icon: 'table', label: 'Ders'},{id: 'annual', icon: 'calendar-alt', label: 'YÄ±llÄ±k'},{id: 'promotion', icon: 'chart-pie', label: 'Puan'}].map(t => (<button key={t.id} onClick={() => setView(t.id)} className={`flex flex-col items-center gap-1 ${view === t.id ? 'text-blue-400' : 'text-slate-500 hover:text-slate-400'}`}><i className={`fas fa-${t.icon} text-lg`}></i><span className="text-[10px] uppercase font-bold">{t.label}</span></button>))}
                    </div>

                    {!isScreenshotMode && <button onClick={() => setPomodoro(prev => ({...prev, active: !prev.active}))} className={`fixed bottom-24 left-4 z-50 w-12 h-12 rounded-full flex items-center justify-center shadow-lg transition-all border border-slate-700 no-screenshot ${pomodoro.active ? 'bg-red-600 animate-pulse' : 'bg-slate-800 text-slate-400 hover:text-white'}`}>{pomodoro.active ? <span className="text-xs font-bold text-white">{Math.floor(pomodoro.time/60)}:{String(pomodoro.time%60).padStart(2,'0')}</span> : <i className="fas fa-stopwatch text-xl"></i>}</button>}

                    {activeModal === 'settings' && (<div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[70] flex items-center justify-center p-4 animate-enter no-screenshot"><div className="bg-slate-800 w-full max-w-sm rounded-2xl p-6 border border-slate-700 shadow-2xl relative"><button onClick={() => setActiveModal(null)} className="absolute top-4 right-4 text-slate-400 hover:text-white"><i className="fas fa-times"></i></button><h3 className="text-white font-bold mb-4">Ayarlar</h3><form onSubmit={handleUpdateUser} className="space-y-4"><div><label className="text-xs text-slate-400">Ad Soyad</label><input name="name" defaultValue={user.name} required className="w-full input-dark p-3 rounded-lg" /></div><div><label className="text-xs text-slate-400">Ãœniversite</label><select name="uni" defaultValue={user.uni} className="w-full input-dark p-3 rounded-lg">{UNIVERSITIES.map(u => <option key={u.name} value={u.name}>{u.name}</option>)}</select></div><div className="flex items-center gap-3 pt-2"><input type="checkbox" name="enablePrayer" defaultChecked={user.enablePrayer} className="w-5 h-5 accent-blue-500" /><span className="text-sm text-slate-300">Namaz Vakitlerini GÃ¶ster</span></div><button className="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-500">Kaydet</button></form><hr className="border-slate-700 my-4" /><div className="flex gap-2"><button onClick={exportData} className="flex-1 bg-green-900/50 border border-green-800 text-green-100 text-xs py-2 rounded hover:bg-green-800">Yedek Ä°ndir (.txt)</button><button onClick={importData} className="flex-1 bg-blue-900/50 border border-blue-800 text-blue-100 text-xs py-2 rounded hover:bg-blue-800">Yedek YÃ¼kle</button></div></div></div>)}
                    {activeModal === 'task' && (<div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-enter no-screenshot"><div className="bg-slate-800 w-full max-w-sm rounded-2xl p-6 border border-slate-700 shadow-2xl"><h3 className="text-white font-bold mb-4">{editingTask ? 'GÃ¶revi DÃ¼zenle' : 'Yeni HatÄ±rlatÄ±cÄ±'}</h3><div className="space-y-3"><input className="w-full input-dark p-3 rounded" placeholder="BaÅŸlÄ±k" value={newTask.title} onChange={e=>{setNewTask({...newTask,title:e.target.value}); setConflictWarn(null);}} /><div className="grid grid-cols-2 gap-2"><select className="w-full input-dark p-3 rounded" value={newTask.category} onChange={e=>setNewTask({...newTask,category:e.target.value})}><option value="daily">GÃ¼ndelik Ä°ÅŸ (Mavi)</option><option value="official">Resmi ToplantÄ± (SarÄ±)</option><option value="special">Ã–zel GÃ¼n (Pembe)</option></select><input type="time" className="w-full input-dark p-3 rounded" value={newTask.time} onChange={e=>{setNewTask({...newTask,time:e.target.value}); setConflictWarn(null);}} /></div><input type="date" className="w-full input-dark p-3 rounded" value={newTask.date} onChange={e=>{setNewTask({...newTask,date:e.target.value}); setConflictWarn(null);}} /><textarea className="w-full input-dark p-3 rounded h-20 resize-none" placeholder="AÃ§Ä±klama..." value={newTask.desc} onChange={e=>setNewTask({...newTask,desc:e.target.value})}></textarea><div className="bg-slate-900/50 p-3 rounded-lg border border-slate-700"><div className="flex items-center justify-between mb-2"><span className="text-xs text-slate-300">Rutin Tekrar?</span><input type="checkbox" checked={isRecurring} onChange={e=>setIsRecurring(e.target.checked)} className="w-4 h-4 accent-blue-500" disabled={!!editingTask} /></div>{isRecurring && (<div className="flex items-center gap-2 animate-enter"><span className="text-[10px] text-slate-400">KaÃ§ Hafta?</span><input type="number" value={recurringWeeks} onChange={e=>setRecurringWeeks(parseInt(e.target.value))} className="w-16 bg-slate-900 border border-slate-600 rounded p-1 text-center text-white text-xs" /></div>)}</div></div><div className="flex gap-2 mt-4"><button onClick={()=>setActiveModal(null)} className="flex-1 py-3 rounded bg-slate-700 text-slate-400 hover:bg-slate-600">Ä°ptal</button><button onClick={handleAddTask} className={`flex-1 py-3 rounded text-white font-bold transition ${conflictWarn ? 'bg-red-600 hover:bg-red-700 animate-pulse' : 'bg-blue-600 hover:bg-blue-500'}`}>{conflictWarn ? 'âš ï¸ Yine de Ekle?' : (editingTask ? 'GÃ¼ncelle' : 'Kaydet')}</button></div>{conflictWarn && <div className="mt-2 text-center text-xs text-red-300 bg-red-900/20 p-2 rounded">{conflictWarn}</div>}</div></div>)}
                    {activeModal === 'notes' && (<div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-enter no-screenshot"><div className="bg-slate-800 w-full max-w-sm rounded-2xl p-6 border border-slate-700 shadow-2xl h-[60vh] flex flex-col"><div className="flex justify-between mb-4"><h3 className="text-white font-bold">Not Defteri</h3><button onClick={()=>setActiveModal(null)}><i className="fas fa-times text-slate-400"></i></button></div><div className="flex gap-2 mb-4"><input className="flex-1 input-dark p-2 rounded" placeholder="Notunuz..." value={newNote} onChange={e=>setNewNote(e.target.value)} /><button onClick={handleAddNote} className="bg-blue-600 px-4 rounded text-white"><i className="fas fa-plus"></i></button></div><div className="flex-1 overflow-y-auto space-y-2">{notes.map(n=><div key={n.id} className="bg-slate-700 p-3 rounded flex justify-between items-start"><div><p className="text-sm text-white">{n.text}</p><p className="text-[10px] text-slate-400">{n.date}</p></div><button onClick={()=>setNotes(notes.filter(x=>x.id!==n.id))} className="text-red-400"><i className="fas fa-trash"></i></button></div>)}</div></div></div>)}
                    {activeModal === 'lesson' && editingLesson && (<div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-enter no-screenshot"><div className="bg-slate-800 w-full max-w-sm rounded-2xl p-6 border border-slate-700 shadow-2xl"><h3 className="text-white font-bold mb-4">Ders DÃ¼zenle</h3><div className="mb-4"><label className="text-xs text-slate-400 block mb-1">Ders AdÄ±</label><input className="w-full input-dark p-3 rounded" value={editingLesson.data.name} onChange={e=>setEditingLesson({...editingLesson,data:{...editingLesson.data,name:e.target.value}})} /></div>
                    <div className="mb-4"><label className="text-xs text-slate-400 block mb-1">SÃ¼re (Saat)</label><input type="number" min="1" max="8" className="w-full input-dark p-3 rounded" value={editingLesson.data.duration || 1} onChange={e=>setEditingLesson({...editingLesson,data:{...editingLesson.data,duration:e.target.value}})} /></div>
                    <div className="mb-6"><label className="text-xs text-slate-400 block mb-1">TÃ¼r (Renk SeÃ§imi)</label><div className="grid grid-cols-2 gap-2">{Object.entries(LESSON_TYPES).map(([k,v])=>(<button key={k} onClick={()=>setEditingLesson({...editingLesson,data:{...editingLesson.data,type:k}})} className={`p-2 rounded border text-xs font-bold transition ${editingLesson.data.type===k?'ring-2 ring-white scale-105':'opacity-80'} ${v.btnClass}`}>{v.label}</button>))}</div></div>
                    <div className="flex gap-2"><button onClick={deleteLesson} className="flex-1 py-3 rounded bg-slate-700 text-red-400 hover:bg-slate-600">Sil</button><button onClick={saveLesson} className="flex-1 py-3 rounded bg-blue-600 text-white font-bold hover:bg-blue-500">Kaydet</button></div></div></div>)}
                    {activeModal === 'dayDetail' && dayDetailData && (<div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[70] flex items-center justify-center p-4 animate-enter no-screenshot"><div className="bg-slate-800 w-full max-w-sm rounded-2xl p-6 border border-slate-700 shadow-2xl max-h-[80vh] overflow-y-auto"><div className="flex justify-between items-center mb-4"><h3 className="text-white font-bold">{dayDetailData.date} DetayÄ±</h3><button onClick={() => { setActiveModal(null); setDayDetailData(null); }} className="text-slate-400 hover:text-white"><i className="fas fa-times"></i></button></div><div className="space-y-3">{dayDetailData.events.map((ev, i) => (<div key={i} className={`p-3 rounded border-l-4 flex justify-between items-center ${ev.category==='academic'?'bg-red-900/30 border-red-500': ev.category==='official'?'bg-amber-900/30 border-amber-500': ev.category==='special'?'bg-pink-900/30 border-pink-500':'bg-blue-900/30 border-blue-500'}`} onClick={() => { if(ev.origin === 'personal') { openEditTask(ev); setDayDetailData(null); } }}><div><div className="text-sm font-bold text-white">{ev.event}</div>{ev.time && <div className="text-xs text-slate-400 mt-1"><i className="far fa-clock mr-1"></i>{ev.time}</div>}<div className="text-[10px] text-slate-500 mt-1 uppercase">{ev.origin}</div></div>{ev.origin === 'personal' && <button onClick={(e) => deleteTask(e, ev.id)} className="text-red-400 hover:text-red-300 px-2 ml-2"><i className="fas fa-trash"></i></button>}</div>))}</div><div className="mt-6 pt-4 border-t border-slate-700"><button onClick={() => { setNewTask({ title: "", date: dayDetailData.date, time: "09:00", desc: "", type: "task", category: "daily" }); setActiveModal('task'); }} className="w-full bg-slate-700 text-white py-2 rounded-lg text-sm hover:bg-slate-700 transition flex items-center justify-center gap-2"><i className="fas fa-plus"></i> Bu GÃ¼ne HatÄ±rlatÄ±cÄ± Ekle</button></div></div></div>)}
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
